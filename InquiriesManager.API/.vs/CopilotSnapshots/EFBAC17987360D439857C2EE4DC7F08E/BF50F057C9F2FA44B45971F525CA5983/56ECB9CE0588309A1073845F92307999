-- Stored Procedure: MonthlyInquiriesReport
-- Returns: Department, CurrentMonthCount, PreviousMonthCount, LastYearSameMonthCount

CREATE PROCEDURE MonthlyInquiriesReport
    @ReportYear INT,
    @ReportMonth INT
AS
BEGIN
    SELECT 
        Department,
        COUNT(CASE WHEN YEAR(CreatedAt) = @ReportYear AND MONTH(CreatedAt) = @ReportMonth THEN 1 END) AS CurrentMonthCount,
        COUNT(CASE WHEN YEAR(CreatedAt) = @ReportYear AND MONTH(CreatedAt) = @ReportMonth - 1 THEN 1 END) AS PreviousMonthCount,
        COUNT(CASE WHEN YEAR(CreatedAt) = @ReportYear - 1 AND MONTH(CreatedAt) = @ReportMonth THEN 1 END) AS LastYearSameMonthCount
    FROM Inquiries
    GROUP BY Department
END
GO

-- Explanation:
-- The query groups inquiries by department and counts for the current month, previous month, and same month last year.
-- Performance can be improved by:
-- 1. Adding an index on CreatedAt and Department columns.
-- 2. Ensuring statistics are up-to-date.
-- 3. Avoiding functions on columns in WHERE clauses (here, we use them in SELECT, which is fine for aggregation).
